<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>naturf.nodes &mdash; naturf 1.0.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/katex-math.css?v=91adb8b6" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/naturf.css?v=f9b8f5c0" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/getting_started.css?v=be86cd7f" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=1ed6394b"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/katex.min.js?v=be8ff15f"></script>
        <script src="../../_static/auto-render.min.js?v=ad136472"></script>
        <script src="../../_static/katex_autorenderer.js?v=bebc588a"></script>
        <script src="../../_static/design-tabs.js?v=f930bc37"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            naturf
          </a>
              <div class="version">
                1.0.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstarter.html">Quickstarter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">naturf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to <strong>naturf</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_cite.html">How to cite <strong>naturf</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors and Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../footer.html">Acknowledgement</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">naturf</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">naturf.nodes</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for naturf.nodes</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pyproj.crs</span> <span class="kn">import</span> <span class="n">CRS</span>
<span class="kn">from</span> <span class="nn">hamilton.function_modifiers</span> <span class="kn">import</span> <span class="n">extract_columns</span>

<span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="n">Settings</span>


<div class="viewcode-block" id="area_weighted_mean_of_building_heights">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.area_weighted_mean_of_building_heights">[docs]</a>
<span class="k">def</span> <span class="nf">area_weighted_mean_of_building_heights</span><span class="p">(</span>
    <span class="n">buildings_intersecting_plan_area</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the area weighted mean of building heights for each target building in a GeoPandas GeoDataFrame.</span>
<span class="sd">    The entire area of buildings considered to be neighbors are included in the calculation.</span>

<span class="sd">    :param buildings_intersecting_plan_area:    Geometry field for the neighboring buildings from the spatially</span>
<span class="sd">                                                joined data.</span>
<span class="sd">    :type buildings_intersecting_plan_area:     gpd.GeoDataFrame</span>

<span class="sd">    :return:                                    The area weighted mean of building heights for all buildings within the target</span>
<span class="sd">                                                building&#39;s plan area.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">buildings_intersecting_plan_area</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_VOLUME_FIELD</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">buildings_intersecting_plan_area</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_HEIGHT_FIELD</span><span class="p">]</span>
        <span class="o">*</span> <span class="n">buildings_intersecting_plan_area</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_AREA_FIELD</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">volume_sum</span> <span class="o">=</span> <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">)[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_VOLUME_FIELD</span>
    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">area_sum</span> <span class="o">=</span> <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">)[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_AREA_FIELD</span>
    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">volume_sum</span> <span class="o">/</span> <span class="n">area_sum</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>



<div class="viewcode-block" id="average_distance_between_buildings">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.average_distance_between_buildings">[docs]</a>
<span class="k">def</span> <span class="nf">average_distance_between_buildings</span><span class="p">(</span><span class="n">distance_between_buildings</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the average distance from the target building to all neighboring buildings.</span>

<span class="sd">    :param distance_between_buildings:          distance from the target building to each</span>
<span class="sd">                                                neighbor building.</span>
<span class="sd">    :type distance_between_buildings:           pd.Series</span>

<span class="sd">    :return:                                    float</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">distance_between_buildings</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_ID_FIELD</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">DEFAULT_STREET_WIDTH</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                <span class="n">Settings</span><span class="o">.</span><span class="n">DISTANCE_BETWEEN_BUILDINGS</span><span class="p">:</span> <span class="n">Settings</span><span class="o">.</span><span class="n">AVERAGE_DISTANCE_BETWEEN_BUILDINGS</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">AVERAGE_DISTANCE_BETWEEN_BUILDINGS</span><span class="p">]</span></div>



<div class="viewcode-block" id="building_area">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.building_area">[docs]</a>
<span class="k">def</span> <span class="nf">building_area</span><span class="p">(</span><span class="n">building_geometry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the area of the building geometry.</span>

<span class="sd">    :param building_geometry:                       Building Geometry.</span>
<span class="sd">    :type building_geometry:                        pd.Series</span>

<span class="sd">    :return:                                        pd.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">building_geometry</span><span class="o">.</span><span class="n">area</span></div>



<div class="viewcode-block" id="buildings_intersecting_plan_area">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.buildings_intersecting_plan_area">[docs]</a>
<span class="k">def</span> <span class="nf">buildings_intersecting_plan_area</span><span class="p">(</span>
    <span class="n">building_id</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">building_geometry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">building_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">total_plan_area_geometry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">wall_length</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">target_crs</span><span class="p">:</span> <span class="n">CRS</span><span class="p">,</span>
    <span class="n">join_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="n">join_predicate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;intersects&quot;</span><span class="p">,</span>
    <span class="n">join_lsuffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">TARGET</span><span class="p">,</span>
    <span class="n">join_rsuffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Conduct a spatial join to get the building areas that intersect the buffered target buildings.</span>

<span class="sd">    :param building_id:                         Building ID field.</span>
<span class="sd">    :type building_id:                          pd.Series</span>

<span class="sd">    :param building_height:                     Building height field.</span>
<span class="sd">    :type building_height:                      pd.Series</span>

<span class="sd">    :param building_geometry:                   Geometry field for the buildings.</span>
<span class="sd">    :type building_geometry:                    pd.Series</span>

<span class="sd">    :param building_area:                       Building area field.</span>
<span class="sd">    :type building_area:                        pd.Series</span>

<span class="sd">    :param total_plan_area_geometry:            Geometry of the buffered building.</span>
<span class="sd">    :type total_plan_area_geometry:             pd.Series</span>

<span class="sd">    :param target_crs:                          Coordinate reference system field of the parent geometry.</span>
<span class="sd">    :type target_crs:                           pd.Series</span>

<span class="sd">    :param join_type:                           Type of join desired.</span>
<span class="sd">                                                DEFAULT: `left`</span>
<span class="sd">    :type join_type:                            str</span>

<span class="sd">    :param join_predicate:                      Selected topology of join.</span>
<span class="sd">                                                DEFAULT: `intersects`</span>
<span class="sd">    :type join_predicate:                       str</span>

<span class="sd">    :param join_lsuffix:                        Suffix of the left object in the join.</span>
<span class="sd">                                                DEFAULT: `target`</span>
<span class="sd">    :type join_lsuffix:                         str</span>

<span class="sd">    :param join_rsuffix:                        Suffix of the right object in the join.</span>
<span class="sd">                                                DEFAULT: `neighbor`</span>
<span class="sd">    :type join_rsuffix:                         str</span>

<span class="sd">    :return:                                    GeoDataFrame of building areas that intersect the buffered target</span>
<span class="sd">                                                buildings and their attributes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">ID_FIELD</span><span class="p">:</span> <span class="n">building_id</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">HEIGHT_FIELD</span><span class="p">:</span> <span class="n">building_height</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">AREA_FIELD</span><span class="p">:</span> <span class="n">building_area</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">:</span> <span class="n">building_geometry</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">BUFFERED_FIELD</span><span class="p">:</span> <span class="n">total_plan_area_geometry</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_NORTH</span><span class="p">:</span> <span class="n">wall_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_NORTH</span><span class="p">],</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_EAST</span><span class="p">:</span> <span class="n">wall_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_EAST</span><span class="p">],</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_SOUTH</span><span class="p">:</span> <span class="n">wall_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_SOUTH</span><span class="p">],</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_WEST</span><span class="p">:</span> <span class="n">wall_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_WEST</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Create left and right GeoDataFrames.</span>
    <span class="n">left_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">BUFFERED_FIELD</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">target_crs</span><span class="p">)</span>
    <span class="n">right_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">target_crs</span><span class="p">)</span>

    <span class="c1"># Spatially join the building areas to the target buffered areas.</span>
    <span class="n">xdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span>
        <span class="n">left_df</span><span class="o">=</span><span class="n">left_gdf</span><span class="p">,</span>
        <span class="n">right_df</span><span class="o">=</span><span class="n">right_gdf</span><span class="p">,</span>
        <span class="n">how</span><span class="o">=</span><span class="n">join_type</span><span class="p">,</span>
        <span class="n">predicate</span><span class="o">=</span><span class="n">join_predicate</span><span class="p">,</span>
        <span class="n">lsuffix</span><span class="o">=</span><span class="n">join_lsuffix</span><span class="p">,</span>
        <span class="n">rsuffix</span><span class="o">=</span><span class="n">join_rsuffix</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add the neighbor building geometry.</span>
    <span class="n">xdf</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">xdf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">ID_FIELD</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">join_rsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">right_gdf</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">ID_FIELD</span><span class="p">)[</span><span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_GEOMETRY_FIELD</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">xdf</span><span class="p">)</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">)</span></div>



<div class="viewcode-block" id="building_plan_area">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.building_plan_area">[docs]</a>
<span class="k">def</span> <span class="nf">building_plan_area</span><span class="p">(</span>
    <span class="n">buildings_intersecting_plan_area</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
    <span class="n">join_predicate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;intersection&quot;</span><span class="p">,</span>
    <span class="n">join_rsuffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the building plan area from the GeoDataFrame of buildings intersecting the plan area.</span>

<span class="sd">    :param buildings_intersecting_plan_area:    Geometry field for the neighboring buildings from the spatially</span>
<span class="sd">                                                joined data.</span>
<span class="sd">    :type buildings_intersecting_plan_area:     gpd.GeoDataFrame</span>

<span class="sd">    :param join_predicate:                      Selected topology of join.</span>
<span class="sd">                                                DEFAULT: `intersection`</span>
<span class="sd">    :type join_predicate:                       str</span>

<span class="sd">    :param join_rsuffix:                        Suffix of the right object in the join.</span>
<span class="sd">                                                DEFAULT: `neighbor`</span>
<span class="sd">    :type join_rsuffix:                         str</span>

<span class="sd">    :return:                                    The building plan area for each unique building in the</span>
<span class="sd">                                                `buildings_intersecting_plan_area` GeoDataFrame.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">building_plan_area</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">target_building_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">building_id_target</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
        <span class="c1"># Get DataFrame with any building that intersects the target_building_id plan area.</span>
        <span class="n">target_building_gdf</span> <span class="o">=</span> <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">buildings_intersecting_plan_area</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_building_id</span>
        <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Create GeoDataFrames with building and neighbor info.</span>
        <span class="n">target_gdf</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">target_building_gdf</span><span class="p">[[</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_BUFFERED_FIELD</span><span class="p">]]</span>
            <span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_BUFFERED_FIELD</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">neighbor_gdf</span> <span class="o">=</span> <span class="n">target_building_gdf</span><span class="p">[</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;index_</span><span class="si">{</span><span class="n">join_rsuffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_GEOMETRY_FIELD</span><span class="p">]</span>
        <span class="p">]</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_GEOMETRY_FIELD</span><span class="p">)</span>

        <span class="c1"># Create a new GeoDataFrame with the area of intersection.</span>
        <span class="n">intersection_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span>
            <span class="n">target_gdf</span><span class="p">,</span> <span class="n">neighbor_gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">join_predicate</span><span class="p">,</span> <span class="n">keep_geom_type</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Sum up the area of intersection and add to the output list.</span>
        <span class="n">building_plan_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intersection_gdf</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">DATA_GEOMETRY_FIELD_NAME</span><span class="p">]</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">building_plan_area</span><span class="p">)</span></div>



<div class="viewcode-block" id="building_surface_area">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.building_surface_area">[docs]</a>
<span class="k">def</span> <span class="nf">building_surface_area</span><span class="p">(</span>
    <span class="n">wall_length</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">building_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the building surface area for each building in a Panda Series. In naturf, the building footprint area is the</span>
<span class="sd">    same as the roof area.</span>

<span class="sd">    :param wall_length:                   Wall length in each cardinal direction for each building.</span>
<span class="sd">    :type wall_length:                    pd.DataFrame</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :param building_area:                 Building area field.</span>
<span class="sd">    :type building_area:                  pd.Series</span>

<span class="sd">    :return:                              Panda Series with building surface area.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wall_area</span> <span class="o">=</span> <span class="n">wall_length</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">building_height</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wall_area</span> <span class="o">+</span> <span class="n">building_area</span></div>



<div class="viewcode-block" id="building_surface_area_to_plan_area_ratio">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.building_surface_area_to_plan_area_ratio">[docs]</a>
<span class="k">def</span> <span class="nf">building_surface_area_to_plan_area_ratio</span><span class="p">(</span>
    <span class="n">building_surface_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">total_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the building surface area to plan area ratio for each building in a Pandas Series. In naturf, the building footprint area is the</span>
<span class="sd">    same as the roof area.</span>

<span class="sd">    :param building_surface_area:         Building surface area for each building.</span>
<span class="sd">    :type building_surface_area:          pd.Series</span>

<span class="sd">    :param total_plan_area:               Total plan area for each building.</span>
<span class="sd">    :type total_plan_area:                pd.Series</span>

<span class="sd">    :return:                              Panda Series with building surface area to plan area ratio.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">building_surface_area</span> <span class="o">/</span> <span class="n">total_plan_area</span></div>



<div class="viewcode-block" id="complete_aspect_ratio">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.complete_aspect_ratio">[docs]</a>
<span class="k">def</span> <span class="nf">complete_aspect_ratio</span><span class="p">(</span>
    <span class="n">building_surface_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">total_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">building_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the complete aspect ratio for each building in a Pandas Series. In naturf, the building footprint area is the</span>
<span class="sd">    same as the roof area, and the exposed ground is the difference between total plan area and building plan area.</span>

<span class="sd">    :param building_surface_area:         Building surface area for each building.</span>
<span class="sd">    :type building_surface_area:          pd.Series</span>

<span class="sd">    :param total_plan_area:               Total plan area for each building.</span>
<span class="sd">    :type total_plan_area:                pd.Series</span>

<span class="sd">    :param building_plan_area:            Building plan area for each building.</span>
<span class="sd">    :type building_plan_area:             pd.Series</span>

<span class="sd">    :return:                              Panda Series with complete aspect ratio.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">exposed_ground</span> <span class="o">=</span> <span class="n">total_plan_area</span> <span class="o">-</span> <span class="n">building_plan_area</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">building_surface_area</span> <span class="o">+</span> <span class="n">exposed_ground</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_plan_area</span></div>



<div class="viewcode-block" id="distance_between_buildings">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.distance_between_buildings">[docs]</a>
<span class="k">def</span> <span class="nf">distance_between_buildings</span><span class="p">(</span><span class="n">buildings_intersecting_plan_area</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the distance between each building and its neighbor as defined in buildings_intersecting_plan_area.</span>

<span class="sd">    :param buildings_intersecting_plan_area:    Geometry field for the neighboring buildings from the spatially</span>
<span class="sd">                                                joined data.</span>
<span class="sd">    :type buildings_intersecting_plan_area:     gpd.GeoDataFrame</span>

<span class="sd">    :return:                                    The distance between each building and its neighbors in a Pandas Series.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">neighbor_geometry</span> <span class="o">=</span> <span class="n">buildings_intersecting_plan_area</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_GEOMETRY_FIELD</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">neighbor_geometry</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">DISTANCE_BETWEEN_BUILDINGS</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="filter_height_range">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.filter_height_range">[docs]</a>
<span class="nd">@extract_columns</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">ID_FIELD</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">HEIGHT_FIELD</span><span class="p">,</span> <span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">filter_height_range</span><span class="p">(</span><span class="n">standardize_column_names_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter out any zero height buildings and reindex the data frame.  Extract the building_id,</span>
<span class="sd">    building_height, and geometry fields to nodes.</span>

<span class="sd">    :param standardize_column_names_df:             GeoDataFrame of the input shapefile with renamed columns.</span>
<span class="sd">    :type standardize_column_names_df:              gpd.GeoDataFrame</span>

<span class="sd">    :return:                                        GeoDataFrame</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">standardize_column_names_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">standardize_column_names_df</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">HEIGHT_FIELD</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">HEIGHT_FIELD</span><span class="p">,</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span>

    <span class="k">return</span> <span class="n">standardize_column_names_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="n">standardize_column_names_df</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">HEIGHT_FIELD</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="frontal_area">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.frontal_area">[docs]</a>
<span class="k">def</span> <span class="nf">frontal_area</span><span class="p">(</span><span class="n">frontal_length</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the frontal area for each building in a Pandas DataFrame in each cardinal direction.</span>

<span class="sd">    :param frontal_length:                Frontal length in each cardinal direction for each building.</span>
<span class="sd">    :type frontal_length:                 pd.DataFrame</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :return:                              Pandas DataFrame with frontal area in each cardinal direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">frontal_area</span> <span class="o">=</span> <span class="n">frontal_length</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">building_height</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">frontal_area</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_NORTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_EAST</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_SOUTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_WEST</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">frontal_area</span></div>



<div class="viewcode-block" id="frontal_area_density">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.frontal_area_density">[docs]</a>
<span class="k">def</span> <span class="nf">frontal_area_density</span><span class="p">(</span>
    <span class="n">frontal_length</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">total_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the frontal area density for each building in a GeoPandas GeoSeries. Frontal area density is the frontal area of a</span>
<span class="sd">    building at a specific height increment divided by the total plan area. naturf calculates frontal area density from the four cardinal</span>
<span class="sd">    directions (east, north, west, south) and at 5 meter increments from ground level to 75 meters unless otherwise specified.</span>

<span class="sd">    :param frontal_length:                Frontal length in each cardinal direction for each building.</span>
<span class="sd">    :type frontal_length:                 pd.DataFrame</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :param total_plan_area:               Total plan area for each building.</span>
<span class="sd">    :type total_plan_area:                pd.Series</span>

<span class="sd">    :return:                              Pandas DataFrame with frontal area density for each cardinal direction and</span>
<span class="sd">                                          each BUILDING_HEIGHT_INTERVAL for each building.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">building_height</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">frontal_area_north</span><span class="p">,</span> <span class="n">frontal_area_east</span><span class="p">,</span> <span class="n">frontal_area_south</span><span class="p">,</span> <span class="n">frontal_area_west</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">)],</span>
        <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">)],</span>
        <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">)],</span>
        <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">)],</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">building</span><span class="p">,</span> <span class="n">building_frontal_length</span> <span class="ow">in</span> <span class="n">frontal_length</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">building_height_counter</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>

        <span class="c1"># Go from ground level to building height by the building height interval and calculate frontal area density.</span>
        <span class="k">for</span> <span class="n">building_height_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]),</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">building_height_counter</span> <span class="o">&lt;=</span> <span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]:</span>
                <span class="n">frontal_area_north</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_NORTH</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">frontal_area_east</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_EAST</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">frontal_area_south</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_SOUTH</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">frontal_area_west</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_WEST</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frontal_area_north</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_NORTH</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                        <span class="o">-</span> <span class="n">building_height_counter</span>
                        <span class="o">+</span> <span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">frontal_area_east</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_EAST</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                        <span class="o">-</span> <span class="n">building_height_counter</span>
                        <span class="o">+</span> <span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">frontal_area_south</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_SOUTH</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                        <span class="o">-</span> <span class="n">building_height_counter</span>
                        <span class="o">+</span> <span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">frontal_area_west</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">building_height_index</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
                <span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">building_frontal_length</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_WEST</span><span class="p">]</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>
                        <span class="o">-</span> <span class="n">building_height_counter</span>
                        <span class="o">+</span> <span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">break</span>
            <span class="n">building_height_counter</span> <span class="o">+=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>

    <span class="n">columns_north</span><span class="p">,</span> <span class="n">columns_east</span><span class="p">,</span> <span class="n">columns_south</span><span class="p">,</span> <span class="n">columns_west</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_NORTH</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">))</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_EAST</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">))</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_SOUTH</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">))</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_WEST</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">))</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">frontal_area_north</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns_north</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">frontal_area_east</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns_east</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">frontal_area_south</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns_south</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">frontal_area_west</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns_west</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="frontal_area_index">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.frontal_area_index">[docs]</a>
<span class="k">def</span> <span class="nf">frontal_area_index</span><span class="p">(</span><span class="n">frontal_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">total_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the frontal area index for each building in a Pandas DataFrame in each cardinal direction.</span>

<span class="sd">    :param frontal_area:                  Frontal area in each cardinal direction for each building.</span>
<span class="sd">    :type frontal_area:                   pd.DataFrame</span>

<span class="sd">    :param total_plan_area:               Total plan area for each building.</span>
<span class="sd">    :type total_plan_area:                pd.Series</span>

<span class="sd">    :return:                              Pandas DataFrame with frontal area index in each cardinal direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">frontal_area_index</span> <span class="o">=</span> <span class="n">frontal_area</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">total_plan_area</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">frontal_area_index</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_INDEX_NORTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_INDEX_EAST</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_INDEX_SOUTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_AREA_INDEX_WEST</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">frontal_area_index</span></div>



<div class="viewcode-block" id="frontal_length">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.frontal_length">[docs]</a>
<span class="k">def</span> <span class="nf">frontal_length</span><span class="p">(</span>
    <span class="n">buildings_intersecting_plan_area</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the frontal length for each cardinal direction from the GeoDataFrame of buildings intersecting the plan area.</span>
<span class="sd">    `buildings_intersecting_plan_area()` needs to include `wall_length`.</span>

<span class="sd">    :param buildings_intersecting_plan_area:    Geometry field for the neighboring buildings from the spatially</span>
<span class="sd">                                                joined data.</span>
<span class="sd">    :type buildings_intersecting_plan_area:     gpd.GeoDataFrame</span>

<span class="sd">    :return:                                    The frontal area for each cardinal direction for each unique building in the</span>
<span class="sd">                                                `buildings_intersecting_plan_area` GeoDataFrame.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number_target_buildings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">building_id_target</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="n">frontal_length_north</span><span class="p">,</span> <span class="n">frontal_length_east</span><span class="p">,</span> <span class="n">frontal_length_south</span><span class="p">,</span> <span class="n">frontal_length_west</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_target_buildings</span><span class="p">,</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_target_buildings</span><span class="p">,</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_target_buildings</span><span class="p">,</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_target_buildings</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">target_building_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">building_id_target</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
        <span class="c1"># Get DataFrame with any building that intersects the target_building_id plan area.</span>
        <span class="n">target_building_gdf</span> <span class="o">=</span> <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">buildings_intersecting_plan_area</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_building_id</span>
        <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Sum frontal length for each cardinal direction</span>
        <span class="n">frontal_length_north</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_building_gdf</span><span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_NORTH</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">frontal_length_east</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_building_gdf</span><span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_EAST</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">frontal_length_south</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_building_gdf</span><span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_SOUTH</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">frontal_length_west</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_building_gdf</span><span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_WEST</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">frontal_length_north</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_NORTH</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">frontal_length_east</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_EAST</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">frontal_length_south</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_SOUTH</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">frontal_length_west</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">FRONTAL_LENGTH_WEST</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="grimmond_oke_displacement_height">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.grimmond_oke_displacement_height">[docs]</a>
<span class="k">def</span> <span class="nf">grimmond_oke_displacement_height</span><span class="p">(</span><span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Grimmond &amp; Oke displacement height for each building</span>

<span class="sd">    :param building_height:                     Building height field.</span>
<span class="sd">    :type building_height:                      pd.Series</span>

<span class="sd">    :return:                                    pd.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">building_height</span> <span class="o">*</span> <span class="n">Settings</span><span class="o">.</span><span class="n">DISPLACEMENT_HEIGHT_FACTOR</span></div>



<div class="viewcode-block" id="grimmond_oke_roughness_length">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.grimmond_oke_roughness_length">[docs]</a>
<span class="k">def</span> <span class="nf">grimmond_oke_roughness_length</span><span class="p">(</span><span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Grimmond &amp; Oke roughness length for each building</span>

<span class="sd">    :param building_height:                     Building height field.</span>
<span class="sd">    :type building_height:                      pd.Series</span>

<span class="sd">    :return:                                    pd.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">building_height</span> <span class="o">*</span> <span class="n">Settings</span><span class="o">.</span><span class="n">ROUGHNESS_LENGTH_FACTOR</span></div>



<div class="viewcode-block" id="height_to_width_ratio">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.height_to_width_ratio">[docs]</a>
<span class="k">def</span> <span class="nf">height_to_width_ratio</span><span class="p">(</span>
    <span class="n">mean_building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">average_distance_between_buildings</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the height to width ratio for each building.</span>

<span class="sd">    :param mean_building_height:           Series of mean building height for all buildings within the target building&#39;s plan area</span>
<span class="sd">    :type mean_building_height:            pd.Series</span>

<span class="sd">    :param average_distance_between_buildings: Series of average distance from each building to all neighboring buildings</span>
<span class="sd">    :type average_distance_between_buildings:  pd.Series</span>

<span class="sd">    :return:                                   pd.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">mean_building_height</span> <span class="o">/</span> <span class="n">average_distance_between_buildings</span></div>



<div class="viewcode-block" id="input_shapefile_df">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.input_shapefile_df">[docs]</a>
<span class="k">def</span> <span class="nf">input_shapefile_df</span><span class="p">(</span><span class="n">input_shapefile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Import shapefile to GeoDataFrame using only desired columns.</span>

<span class="sd">    :params input_shapefile:                        Full path with file name and extension to the input shapefile.</span>
<span class="sd">    :type input_shapefile:                          str</span>

<span class="sd">    :return:                                        GeoDataFrame</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">input_shapefile</span><span class="p">)[</span>
        <span class="p">[</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">DATA_ID_FIELD_NAME</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">DATA_HEIGHT_FIELD_NAME</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">DATA_GEOMETRY_FIELD_NAME</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">DATA_GEOMETRY_FIELD_NAME</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gdf</span></div>



<div class="viewcode-block" id="lot_area">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.lot_area">[docs]</a>
<span class="k">def</span> <span class="nf">lot_area</span><span class="p">(</span>
    <span class="n">buildings_intersecting_plan_area</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">building_surface_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the lot area for each building in a Panda Series. Lot area is the total surface area of all buildings</span>
<span class="sd">    within a given building&#39;s plan area divided by the number of buildings in the plan area.&quot;</span>

<span class="sd">    :param buildings_intersecting_plan_area:    Geometry field for the neighboring buildings from the spatially</span>
<span class="sd">                                                joined data.</span>
<span class="sd">    :type buildings_intersecting_plan_area:     gpd.GeoDataFrame</span>

<span class="sd">    :param building_surface_area:               Building surface area for each building.</span>
<span class="sd">    :type building_surface_area:                pd.Series</span>

<span class="sd">    :return:                                    Panda Series of lot area for each building.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">building_surface_area</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_SURFACE_AREA</span><span class="p">),</span>
        <span class="n">on</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;index_</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">)[</span><span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_SURFACE_AREA</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>



<div class="viewcode-block" id="macdonald_displacement_height">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.macdonald_displacement_height">[docs]</a>
<span class="k">def</span> <span class="nf">macdonald_displacement_height</span><span class="p">(</span>
    <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">plan_area_fraction</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Macdonald et al. displacement height for each building in a Pandas Series.</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :param plan_area_fraction:            Plan area fraction for each building.</span>
<span class="sd">    :type plan_area_fraction:             pd.Series</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">alpha_coefficient</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">ALPHACOEFFICIENT</span>

    <span class="n">plan_area_minus_one</span> <span class="o">=</span> <span class="n">plan_area_fraction</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">alpha_exponent</span> <span class="o">=</span> <span class="n">alpha_coefficient</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">plan_area_fraction</span><span class="p">)</span>

    <span class="n">right_side</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">alpha_exponent</span> <span class="o">*</span> <span class="n">plan_area_minus_one</span>

    <span class="k">return</span> <span class="n">right_side</span> <span class="o">*</span> <span class="n">building_height</span></div>



<div class="viewcode-block" id="macdonald_roughness_length">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.macdonald_roughness_length">[docs]</a>
<span class="k">def</span> <span class="nf">macdonald_roughness_length</span><span class="p">(</span>
    <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">macdonald_displacement_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">frontal_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">lot_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Macdonald et al. roughness length for each building in a Pandas Series.</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :param macdonald_displacement_height: Macdonald displacement height for each building.</span>
<span class="sd">    :type macdonald_displacement_height:  pd.Series</span>

<span class="sd">    :param frontal_area:                  Frontal area  for each building in each cardinal direction.</span>
<span class="sd">    :type frontal_area:                   pd.DataFrame</span>

<span class="sd">    :param lot_area:                      Lot area for each building.</span>
<span class="sd">    :type lot_area:                       pd.Series</span>

<span class="sd">    :return:                              Panda Series with Macdonald roughness length for each building in each cardinal direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">obstacle_drag_coefficient</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">OBSTACLEDRAGCOEFFICIENT</span>
    <span class="n">von_karman_constant</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">VONKARMANCONSTANT</span>
    <span class="n">beta_coefficient</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BETACOEFFICIENT</span>

    <span class="n">one_minus_height_ratio</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">macdonald_displacement_height</span> <span class="o">/</span> <span class="n">building_height</span>

    <span class="n">drag_over_von_karman</span> <span class="o">=</span> <span class="n">obstacle_drag_coefficient</span> <span class="o">/</span> <span class="n">von_karman_constant</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">frontal_divided_by_lot</span> <span class="o">=</span> <span class="n">frontal_area</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">lot_area</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">inside_exponential</span> <span class="o">=</span> <span class="o">-</span><span class="n">frontal_divided_by_lot</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span>
        <span class="mf">0.5</span> <span class="o">*</span> <span class="n">beta_coefficient</span> <span class="o">*</span> <span class="n">drag_over_von_karman</span> <span class="o">*</span> <span class="n">one_minus_height_ratio</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">exponential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">inside_exponential</span><span class="p">)</span>

    <span class="n">right_side</span> <span class="o">=</span> <span class="n">exponential</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">one_minus_height_ratio</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">macdonald_roughness_length</span> <span class="o">=</span> <span class="n">right_side</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">building_height</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">macdonald_roughness_length</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">MACDONALD_ROUGHNESS_LENGTH_NORTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">MACDONALD_ROUGHNESS_LENGTH_EAST</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">MACDONALD_ROUGHNESS_LENGTH_SOUTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">MACDONALD_ROUGHNESS_LENGTH_WEST</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">macdonald_roughness_length</span></div>



<div class="viewcode-block" id="mean_building_height">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.mean_building_height">[docs]</a>
<span class="k">def</span> <span class="nf">mean_building_height</span><span class="p">(</span><span class="n">buildings_intersecting_plan_area</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the mean building height for all buildings within the target building&#39;s total plan area.</span>

<span class="sd">    :param buildings_intersecting_plan_area:    Geometry field for the neighboring buildings from the spatially</span>
<span class="sd">                                                joined data.</span>
<span class="sd">    :type buildings_intersecting_plan_area:     gpd.GeoDataFrame</span>

<span class="sd">    :return:                                    The mean building height for all buildings within the target building&#39;s plan area.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">)[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_HEIGHT_FIELD</span>
    <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>



<div class="viewcode-block" id="plan_area_density">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.plan_area_density">[docs]</a>
<span class="k">def</span> <span class="nf">plan_area_density</span><span class="p">(</span>
    <span class="n">building_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">total_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the plan area density for each building in a GeoPandas GeoSeries. Plan area density is the building plan area</span>
<span class="sd">    at a specific height increment divided by the total plan area. naturf calculates plan area density from the four cardinal</span>
<span class="sd">    directions (north, east, south, west) and at 5-meter increments from ground level to 75 meters unless otherwise specified.</span>

<span class="sd">    :param building_plan_area:            Building plan area for each building.</span>
<span class="sd">    :type building_plan_area:             pd.Series</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :param total_plan_area:               Total plan area for each building.</span>
<span class="sd">    :type total_plan_area:                pd.Series</span>

<span class="sd">    :return:                              Pandas DataFrame with plan area density for each BUILDING_HEIGHT_INTERVAL for each building.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">building_height</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">plan_area_density</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">building_plan_area</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">building_height_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Go from ground level to building height by the building height interval and calculate plan area density.</span>
        <span class="k">while</span> <span class="n">building_height_counter</span> <span class="o">&lt;</span> <span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]:</span>
            <span class="n">plan_area_density</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">building_height_counter</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">building_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_plan_area</span><span class="p">[</span><span class="n">building</span><span class="p">])</span>
            <span class="n">building_height_counter</span> <span class="o">+=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>

    <span class="n">columns_plan_area_density</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">PLAN_AREA_DENSITY</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">plan_area_density</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns_plan_area_density</span><span class="p">)</span></div>



<div class="viewcode-block" id="plan_area_fraction">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.plan_area_fraction">[docs]</a>
<span class="k">def</span> <span class="nf">plan_area_fraction</span><span class="p">(</span><span class="n">building_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">total_plan_area</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the plan area fraction for each building in a Pandas Series. Plan area fraction is the building plan area at ground level</span>
<span class="sd">    for each building divided by the total plan area.</span>

<span class="sd">    :param building_plan_area:            Building plan area for each building.</span>
<span class="sd">    :type building_plan_area:             pd.Series</span>

<span class="sd">    :param total_plan_area:               Total plan area for each building.</span>
<span class="sd">    :type total_plan_area:                pd.Series</span>

<span class="sd">    :return:                              Pandas Series with plan area fraction for each building.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">building_plan_area</span> <span class="o">/</span> <span class="n">total_plan_area</span></div>



<div class="viewcode-block" id="raupach_displacement_height">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.raupach_displacement_height">[docs]</a>
<span class="k">def</span> <span class="nf">raupach_displacement_height</span><span class="p">(</span>
    <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">frontal_area_index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Raupach displacement height for each building in each cardinal direction in a Panda Series. Default values for constants are set</span>
<span class="sd">    in the config file.</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :param frontal_area_index:            Frontal area index for each building in each cardinal direction.</span>
<span class="sd">    :type frontal_area_index:             pd.DataFrame</span>

<span class="sd">    :return:                              Pandas DataFrame with Raupach displacement height in each cardinal direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">constant_75</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CONSTANT_75</span>
    <span class="n">capital_lambda</span> <span class="o">=</span> <span class="n">frontal_area_index</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">sqrt_constant_lambda</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">capital_lambda</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">constant_75</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sqrt_constant_lambda</span><span class="p">)</span>

    <span class="n">raupach_displacement_height</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">sqrt_constant_lambda</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span>
        <span class="n">building_height</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="n">raupach_displacement_height</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_DISPLACEMENT_HEIGHT_NORTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_DISPLACEMENT_HEIGHT_EAST</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_DISPLACEMENT_HEIGHT_SOUTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_DISPLACEMENT_HEIGHT_WEST</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">raupach_displacement_height</span></div>



<div class="viewcode-block" id="raupach_roughness_length">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.raupach_roughness_length">[docs]</a>
<span class="k">def</span> <span class="nf">raupach_roughness_length</span><span class="p">(</span>
    <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">frontal_area_index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">raupach_displacement_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Raupach roughness length for each building in each cardinal direction in a Panda Series. Default values for constants are set</span>
<span class="sd">    in the config file.</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :param frontal_area_index:            Frontal area index for each building in each cardinal direction.</span>
<span class="sd">    :type frontal_area_index:             pd.DataFrame</span>

<span class="sd">    :param raupach_displacment_height:    Raupach displacment height for each building in each cardinal direction.</span>
<span class="sd">    :type raupach_displacment_height:     pd.DataFrame</span>

<span class="sd">    :return:                              Pandas DataFrame with Raupach roughness length in each cardinal direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_ROUGHNESS_LENGTH_NORTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_ROUGHNESS_LENGTH_EAST</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_ROUGHNESS_LENGTH_SOUTH</span><span class="p">,</span>
        <span class="n">Settings</span><span class="o">.</span><span class="n">RAUPACH_ROUGHNESS_LENGTH_WEST</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">cols_fai</span> <span class="o">=</span> <span class="n">frontal_area_index</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">cols_rdh</span> <span class="o">=</span> <span class="n">raupach_displacement_height</span><span class="o">.</span><span class="n">columns</span>

    <span class="n">von_karman_constant</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">VONKARMANCONSTANT</span>
    <span class="n">drag_coefficient_03</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">DRAGCOEFFICIENT_03</span>
    <span class="n">drag_coefficient_0003</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">DRAGCOEFFICIENT_0003</span>
    <span class="n">psi_h</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">PSI_H</span>

    <span class="n">frontal_area_index</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
    <span class="n">raupach_displacement_height</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>

    <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">drag_coefficient_0003</span> <span class="o">+</span> <span class="n">drag_coefficient_03</span> <span class="o">*</span> <span class="n">frontal_area_index</span><span class="p">)</span>

    <span class="n">one_minus_displacement_height</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">raupach_displacement_height</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">building_height</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">exponential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">von_karman_constant</span> <span class="o">/</span> <span class="n">denominator</span> <span class="o">-</span> <span class="n">psi_h</span><span class="p">)</span>

    <span class="n">raupach_roughness_length</span> <span class="o">=</span> <span class="n">exponential</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">one_minus_displacement_height</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span>
        <span class="n">building_height</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="n">frontal_area_index</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols_fai</span>
    <span class="n">raupach_displacement_height</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols_rdh</span>

    <span class="k">return</span> <span class="n">raupach_roughness_length</span></div>



<div class="viewcode-block" id="rooftop_area_density">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.rooftop_area_density">[docs]</a>
<span class="k">def</span> <span class="nf">rooftop_area_density</span><span class="p">(</span><span class="n">plan_area_density</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the rooftop area density for each building in a Pandas DataFrame. Rooftop area density is the roof area</span>
<span class="sd">    of all buildings within the total plan area  at a specified height increment divided by the total plan area. naturf</span>
<span class="sd">    projects building footprints vertically to the building height, meaning that rooftop area density is equal to the plan area</span>
<span class="sd">    density.</span>

<span class="sd">    :param plan_area_density:            Plan area density at each specified height increment.</span>
<span class="sd">    :type plan_area_density:             pd.DataFrame</span>

<span class="sd">    :return:                             Pandas DataFrame with rooftop area density for each BUILDING_HEIGHT_INTERVAL for each building.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">columns_rooftop_area_density</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">ROOFTOP_AREA_DENSITY</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">plan_area_density</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns_rooftop_area_density</span><span class="p">)</span></div>



<div class="viewcode-block" id="sky_view_factor">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.sky_view_factor">[docs]</a>
<span class="k">def</span> <span class="nf">sky_view_factor</span><span class="p">(</span>
    <span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">average_distance_between_buildings</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the 2D sky view factor for each building.</span>

<span class="sd">    :param building_height:                     Building height field.</span>
<span class="sd">    :type building_height:                      pd.Series</span>

<span class="sd">    :param average_distance_between_buildings:  Average distance between the target building and all neighboring buildings.</span>
<span class="sd">    :type average_distance_between_buildings:   float</span>

<span class="sd">    :return:                                    pd.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">building_height</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">average_distance_between_buildings</span><span class="p">)))</span></div>



<div class="viewcode-block" id="standard_deviation_of_building_heights">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.standard_deviation_of_building_heights">[docs]</a>
<span class="k">def</span> <span class="nf">standard_deviation_of_building_heights</span><span class="p">(</span>
    <span class="n">buildings_intersecting_plan_area</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the standard deviation of building heights for all buildings within the target building&#39;s total plan area.</span>

<span class="sd">    :param buildings_intersecting_plan_area:    Geometry field for the neighboring buildings from the spatially</span>
<span class="sd">                                                joined data.</span>
<span class="sd">    :type buildings_intersecting_plan_area:     gpd.GeoDataFrame</span>

<span class="sd">    :return:                                    The standard deviation of building heights for all buildings within the target building&#39;s plan area.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">buildings_intersecting_plan_area</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">TARGET_ID_FIELD</span><span class="p">)[</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">NEIGHBOR_HEIGHT_FIELD</span>
        <span class="p">]</span>
        <span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>



<div class="viewcode-block" id="standardize_column_names_df">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.standardize_column_names_df">[docs]</a>
<span class="k">def</span> <span class="nf">standardize_column_names_df</span><span class="p">(</span><span class="n">input_shapefile_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Standardize field names so use throughout code will be consistent throughout.</span>

<span class="sd">    :params input_shapefile_df:                     GeoDataFrame of from the input shapefile.</span>
<span class="sd">    :type input_shapefile_df:                       gpd.GeoDataFrame</span>

<span class="sd">    :return:                                        GeoDataFrame</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># standardize field names from data to reference names in code</span>
    <span class="n">input_shapefile_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">DATA_ID_FIELD_NAME</span><span class="p">:</span> <span class="n">Settings</span><span class="o">.</span><span class="n">ID_FIELD</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">DATA_HEIGHT_FIELD_NAME</span><span class="p">:</span> <span class="n">Settings</span><span class="o">.</span><span class="n">HEIGHT_FIELD</span><span class="p">,</span>
            <span class="n">Settings</span><span class="o">.</span><span class="n">DATA_GEOMETRY_FIELD_NAME</span><span class="p">:</span> <span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">input_shapefile_df</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">)</span></div>



<div class="viewcode-block" id="target_crs">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.target_crs">[docs]</a>
<span class="k">def</span> <span class="nf">target_crs</span><span class="p">(</span><span class="n">input_shapefile_df</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CRS</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract coordinate reference system from geometry.</span>

<span class="sd">    :params input_shapefile_df:                     GeoDataFrame of from the input shapefile.</span>
<span class="sd">    :type input_shapefile_df:                       gpd.GeoDataFrame</span>

<span class="sd">    :return:                                        pyproj Coordinate Reference System (CRS) object</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">input_shapefile_df</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">GEOMETRY_FIELD</span><span class="p">)</span><span class="o">.</span><span class="n">crs</span></div>



<div class="viewcode-block" id="total_plan_area">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.total_plan_area">[docs]</a>
<span class="k">def</span> <span class="nf">total_plan_area</span><span class="p">(</span><span class="n">total_plan_area_geometry</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the total plan area for each building in a GeoPandas GeoSeries.</span>

<span class="sd">    :param geometry:                    Geometry for a series of buildings.</span>
<span class="sd">    :type geometry:                     gpd.GeoSeries</span>

<span class="sd">    :return:                            Pandas Series with total plan area for each building.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">total_plan_area_geometry</span><span class="o">.</span><span class="n">area</span></div>



<div class="viewcode-block" id="total_plan_area_geometry">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.total_plan_area_geometry">[docs]</a>
<span class="k">def</span> <span class="nf">total_plan_area_geometry</span><span class="p">(</span>
    <span class="n">building_geometry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">RADIUS</span><span class="p">,</span> <span class="n">cap_style</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">CAP_STYLE</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the geometry of the total plan area which is the buffer of the building for the desired radius and cap style.</span>

<span class="sd">    :param building_geometry:                       Geometry of the building.</span>
<span class="sd">    :type building_geometry:                        pd.Series</span>

<span class="sd">    :param radius:                                  The radius of the buffer.</span>
<span class="sd">                                                    100 (default, set in config.py)</span>
<span class="sd">    :type radius:                                   int</span>

<span class="sd">    :param cap_style:                               The shape of the buffer.</span>
<span class="sd">                                                    1 == Round</span>
<span class="sd">                                                    2 == Flat</span>
<span class="sd">                                                    3 == Square (default)</span>

<span class="sd">    :return:                                        pd.Series</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">building_geometry</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">cap_style</span><span class="o">=</span><span class="n">cap_style</span><span class="p">)</span></div>



<div class="viewcode-block" id="vertical_distribution_of_building_heights">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.vertical_distribution_of_building_heights">[docs]</a>
<span class="k">def</span> <span class="nf">vertical_distribution_of_building_heights</span><span class="p">(</span><span class="n">building_height</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent the location of buildings at 5m increments from ground level to 75m unless otherwise specified. If is within a</span>
<span class="sd">    given height bin, it will be given a 1 and it will be given a 0 otherwise.&quot;</span>

<span class="sd">    :param building_height:               Building height for each building.</span>
<span class="sd">    :type building_height:                pd.Series</span>

<span class="sd">    :return:                              Pandas DataFrame with the distribution of building heights at each</span>
<span class="sd">                                          BUILDING_HEIGHT_INTERVAL for each building.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">building_height</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">vertical_distribution_of_building_heights</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">building_height</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">building_height_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">building_height_counter</span> <span class="o">&lt;</span> <span class="n">building_height</span><span class="p">[</span><span class="n">building</span><span class="p">]:</span>
            <span class="n">vertical_distribution_of_building_heights</span><span class="p">[</span><span class="n">building</span><span class="p">][</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">building_height_counter</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">)</span>
            <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">building_height_counter</span> <span class="o">+=</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span>

    <span class="n">columns_vertical_distribution_of_building_heights</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Settings</span><span class="o">.</span><span class="n">VERTICAL_DISTRIBUTION_OF_BUILDING_HEIGHTS</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">MAX_BUILDING_HEIGHT</span> <span class="o">/</span> <span class="n">Settings</span><span class="o">.</span><span class="n">BUILDING_HEIGHT_INTERVAL</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">vertical_distribution_of_building_heights</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">columns_vertical_distribution_of_building_heights</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="wall_angle_direction_length">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.wall_angle_direction_length">[docs]</a>
<span class="k">def</span> <span class="nf">wall_angle_direction_length</span><span class="p">(</span><span class="n">building_geometry</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the wall angle, direction, and length for each building in a GeoPandas GeoSeries.</span>

<span class="sd">    :param geometry:                    Geometry for a series of buildings.</span>
<span class="sd">    :type geometry:                     pd.Series</span>

<span class="sd">    :return:                            Pandas DataFrame with wall angle, direction, and length for each building.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wall_angle</span><span class="p">,</span> <span class="n">wall_direction</span><span class="p">,</span> <span class="n">wall_length</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">building_geometry</span><span class="o">.</span><span class="n">size</span><span class="p">)],</span>
        <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">building_geometry</span><span class="o">.</span><span class="n">size</span><span class="p">)],</span>
        <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">building_geometry</span><span class="o">.</span><span class="n">size</span><span class="p">)],</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">building</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">building_geometry</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">points_in_polygon</span> <span class="o">=</span> <span class="n">building_geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">building</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">points_in_polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points_in_polygon</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">item</span>

            <span class="c1"># Store the first set of coordinates.</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

                <span class="n">wall_angle</span><span class="p">[</span><span class="n">building</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)))</span>

                <span class="c1"># For each direction, the start degree (from counterclockwise) is included (&lt;=) and the end degree is not included (&lt;).</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">Settings</span><span class="o">.</span><span class="n">NORTHEAST_DEGREES</span>
                    <span class="o">&lt;=</span> <span class="n">wall_angle</span><span class="p">[</span><span class="n">building</span><span class="p">][</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="o">&lt;</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NORTHWEST_DEGREES</span>
                <span class="p">):</span>
                    <span class="n">wall_direction</span><span class="p">[</span><span class="n">building</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">WEST</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">Settings</span><span class="o">.</span><span class="n">SOUTHEAST_DEGREES_ARCTAN</span>
                    <span class="o">&lt;=</span> <span class="n">wall_angle</span><span class="p">[</span><span class="n">building</span><span class="p">][</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="o">&lt;</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NORTHEAST_DEGREES</span>
                <span class="p">):</span>
                    <span class="n">wall_direction</span><span class="p">[</span><span class="n">building</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">NORTH</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">Settings</span><span class="o">.</span><span class="n">SOUTHWEST_DEGREES_ARCTAN</span>
                    <span class="o">&lt;=</span> <span class="n">wall_angle</span><span class="p">[</span><span class="n">building</span><span class="p">][</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="o">&lt;</span> <span class="n">Settings</span><span class="o">.</span><span class="n">SOUTHEAST_DEGREES_ARCTAN</span>
                <span class="p">):</span>
                    <span class="n">wall_direction</span><span class="p">[</span><span class="n">building</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">EAST</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wall_direction</span><span class="p">[</span><span class="n">building</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">SOUTH</span><span class="p">)</span>

                <span class="n">wall_length</span><span class="p">[</span><span class="n">building</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

                <span class="c1"># Reset start coordinates.</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">wall_angle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_ANGLE</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">wall_direction</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_DIRECTION</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">wall_length</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="wall_length">
<a class="viewcode-back" href="../../naturf.html#naturf.nodes.wall_length">[docs]</a>
<span class="k">def</span> <span class="nf">wall_length</span><span class="p">(</span><span class="n">wall_angle_direction_length</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the wall length for each building in a GeoPandas GeoSeries.</span>

<span class="sd">    :param wall_angle_direction_length:                Wall angle, direction, and length for a series of buildings.</span>
<span class="sd">    :type wall_angle_direction_length:                 pd.DataFrame</span>

<span class="sd">    :return:                                           Pandas DataFrame with wall area for each cardinal direction for each building.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wall_length_north</span><span class="p">,</span> <span class="n">wall_length_east</span><span class="p">,</span> <span class="n">wall_length_south</span><span class="p">,</span> <span class="n">wall_length_west</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">wall_angle_direction_length</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">wall_angle_direction_length</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">wall_angle_direction_length</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">wall_angle_direction_length</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">wall_angle_direction_length</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_DIRECTION</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_DIRECTION</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">Settings</span><span class="o">.</span><span class="n">NORTH</span><span class="p">:</span>
                <span class="n">wall_length_north</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_DIRECTION</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">Settings</span><span class="o">.</span><span class="n">EAST</span><span class="p">:</span>
                <span class="n">wall_length_east</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_DIRECTION</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">Settings</span><span class="o">.</span><span class="n">SOUTH</span><span class="p">:</span>
                <span class="n">wall_length_south</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wall_length_west</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">row</span><span class="p">[</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">wall_length_north</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_NORTH</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">wall_length_east</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_EAST</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">wall_length_south</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_SOUTH</span><span class="p">),</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">wall_length_west</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">Settings</span><span class="o">.</span><span class="n">WALL_LENGTH_WEST</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2099, Battelle Memorial Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>